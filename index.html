<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Why Dough Cookies</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç™</text></svg>">
  <!-- Fixed Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { scroll-behavior: smooth; overflow-x: hidden; height: 100%; font-family: 'Poppins', sans-serif; }
    body { scroll-snap-type: y mandatory; }
    
    /* New Nude Gradient Background */
    section { 
      min-height: 100vh; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      padding:2rem; 
      flex-direction:column; 
      text-align:center; 
      scroll-snap-align:start; 
      background-attachment:fixed; 
      background-size:cover; 
      background-position:center; 
      position:relative; 
      background: linear-gradient(135deg, #f5e8d5 0%, #f8f4e9 50%, #fefaf0 100%);
    }
    
    section::before { 
      content: ""; 
      position:absolute; 
      inset:0; 
      background: rgba(255, 248, 240, 0.3); 
      z-index:-1; 
    }
    
    @media (max-width:768px){ 
      section{ padding:1rem; background-attachment:scroll; } 
    }

    /* Modal & lists */
    body.no-scroll { overflow: hidden; }
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 50; justify-content: center; align-items: center; }
    .modal.active { display: flex; }
    .modal-content { background: #fff; border-radius: 12px; width: 90%; max-width: 680px; max-height: 85vh; display: flex; flex-direction: column; overflow: hidden; }
    .modal-header, .modal-footer { padding: 1rem; border-bottom: 1px solid #eee; }
    .modal-footer { border-top: 1px solid #eee; border-bottom: none; }
    .modal-body { flex: 1; overflow-y: auto; padding: 1rem; }

    .boxsize-list, .cookie-list { display:flex; flex-direction:column; gap:10px; margin-top:12px; }
    .boxsize-row, .cookie-row { display:flex; align-items:center; justify-content:space-between; border:1px solid #e5e7eb; border-radius:8px; padding:10px 14px; background:#fafafa; cursor:pointer; transition:background .15s; }
    .boxsize-row:hover, .cookie-row:hover{ background:#f3f4f6; }
    .boxsize-row.active, .cookie-row.active{ border-color:#d97706; background:#fffbeb; }

    .cookie-price { font-size:.9rem; color:#6b7280; margin-left:8px; }
    .quantity-control, .cookie-qty { display:none; align-items:center; gap:8px; }
    .cookie-row.active .quantity-control { display:flex; }
    .cookie-qty-input { width:56px; text-align:center; border:1px solid #d1d5db; border-radius:6px; padding:4px; }
    .qty-btn { background:#111827; color:#fff; border:none; padding:6px 8px; border-radius:6px; cursor:pointer; }
    
    .loading { opacity: 0.6; pointer-events: none; }
    
    /* Cookie card styles */
    .cookie-card { 
      cursor: pointer; 
      transition: all 0.3s ease; 
      border: 2px solid transparent;
      background: #fff;
      box-shadow: 0 2px 8px rgba(120, 53, 15, 0.1);
    }
    .cookie-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(120, 53, 15, 0.15);
      border-color: #d97706;
    }
    .cookie-card.active {
      border-color: #d97706;
      background: #fffbeb;
      box-shadow: 0 4px 15px rgba(120, 53, 15, 0.2);
    }
    .quantity-section {
      display: none;
      margin-top: 12px;
    }
    .cookie-card.active .quantity-section {
      display: flex;
    }
    
    /* Delivery option styles */
    .delivery-option {
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      margin: 8px 0;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #fff;
    }
    .delivery-option:hover {
      border-color: #d97706;
      background: #fffbeb;
    }
    .delivery-option.active {
      border-color: #d97706;
      background: #fffbeb;
    }

    /* Cart styles */
    .cart-item {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      margin: 8px 0;
      background: #fafafa;
    }
    .cart-total {
      font-size: 1.2em;
      font-weight: bold;
      border-top: 2px solid #e5e7eb;
      padding-top: 12px;
      margin-top: 12px;
      color: #78350f;
    }

    /* Enhanced Navigation Buttons */
    .nav-button {
      background: #78350f;
      color: white;
      border: none;
      padding: 12px 32px;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(120, 53, 15, 0.3);
      font-size: 1.1em;
    }
    
    .nav-button:hover {
      background: #92400e;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(120, 53, 15, 0.4);
    }
    
    .nav-button:active {
      transform: translateY(0);
    }
    
    /* Secondary button style */
    .secondary-button {
      background: transparent;
      color: #78350f;
      border: 2px solid #78350f;
      padding: 10px 24px;
      border-radius: 50px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .secondary-button:hover {
      background: #78350f;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(120, 53, 15, 0.3);
    }
    
    /* Arrow button styles */
    .arrow-btn {
      background: #78350f;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 10px rgba(120, 53, 15, 0.3);
      font-size: 18px;
      width: 48px;
      height: 48px;
    }
    
    .arrow-btn:hover {
      background: #92400e;
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(120, 53, 15, 0.4);
    }
    
    .text-link {
      color: #78350f;
      font-weight: 600;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 20px;
      transition: all 0.3s ease;
    }
    
    .text-link:hover {
      background: rgba(120, 53, 15, 0.1);
      text-decoration: underline;
    }

    /* Footer styles */
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(120, 53, 15, 0.9);
      color: white;
      padding: 12px;
      text-align: center;
      font-size: 0.9em;
      z-index: 40;
    }
  </style>
</head>
<body class="text-gray-800">

  <!-- Welcome Section -->
  <section id="section-1" class="relative justify-center">
    <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl max-w-2xl w-full border border-amber-100 mb-16">
      <h1 class="text-5xl font-bold mb-4 text-amber-900">Welcome to Why Dough?</h1>
      
      <!-- New Sub Header -->
      <p class="text-xl text-amber-700 mb-8 leading-relaxed">
        üç™ WHY NOT WHY DOUGH?<br>
        <span class="text-lg">Soft. Chewy. Honest. We dough it better.</span>
      </p>
      
      <!-- Main CTA Button -->
      <div class="mb-8">
        <button onclick="scrollToSection(2)" class="nav-button">
          Shop now!
        </button>
      </div>
      
      <!-- Secondary Action Buttons -->
      <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
        <button class="secondary-button">
          Meet the Dough
        </button>
        <button class="secondary-button">
          View Cookie Menu
        </button>
      </div>
    </div>
    
    <!-- Scroll indicator - Centered -->
    <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce">
      <button onclick="scrollToSection(2)" class="arrow-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12l7 7 7-7"/>
        </svg>
      </button>
    </div>
  </section>

  <!-- Footer -->
  <div class="footer">
    #WhyNotWhyDough  |  #WhyDoughItBetter
  </div>

  <form id="orderForm">
    <!-- Name Section -->
    <section id="section-2" class="relative">
      <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl max-w-md w-full border border-amber-100">
        <label class="text-2xl font-bold mb-4 block text-amber-900">What's your name?</label>
        <input name="name" required type="text" class="w-full border border-amber-200 p-4 rounded-xl mb-6 focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="Your full name" />
        
        <label class="text-lg font-semibold mb-4 block text-amber-800">Facebook or Instagram Name</label>
        <input name="socialHandle" required type="text" placeholder="Enter FB or IG name" class="w-full border border-amber-200 p-4 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent" />
        
        <div class="flex justify-between items-center mt-8">
          <button type="button" onclick="scrollToSection(1)" class="arrow-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19V5M5 12l7-7 7 7"/>
            </svg>
          </button>
          <button type="button" onclick="scrollToSection(3)" class="nav-button">
            Next
          </button>
        </div>
      </div>
    </section>

    <!-- Delivery date & method -->
    <section id="section-3" class="relative">
      <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl max-w-md w-full border border-amber-100">
        <label class="text-2xl font-bold mb-4 block text-amber-900">Delivery Date</label>
        <div id="quickDates" class="grid grid-cols-3 gap-3 mb-6"></div>
        <a href="#" onclick="openDateInput();return false;" class="text-link block mb-4">Pick another date</a>
        <input name="deliveryDate" id="deliveryDateInput" required type="date" class="w-full border border-amber-200 p-4 rounded-xl hidden focus:ring-2 focus:ring-amber-500 focus:border-transparent" />
        
        <!-- Delivery Method -->
        <label class="text-2xl font-bold mb-4 block mt-8 text-amber-900">Delivery Method</label>
        <div class="space-y-3">
          <div class="delivery-option" onclick="selectDeliveryMethod(this, 'pickup')">
            <input type="radio" name="deliveryMethod" value="pickup" class="hidden">
            <span class="font-semibold text-amber-900">üõµ Pick Up</span>
          </div>
          <div class="delivery-option" onclick="selectDeliveryMethod(this, 'delivery')">
            <input type="radio" name="deliveryMethod" value="delivery" class="hidden">
            <span class="font-semibold text-amber-900">üöö Delivery</span>
          </div>
        </div>
        
        <div class="flex justify-between items-center mt-8">
          <button type="button" onclick="scrollToSection(2)" class="arrow-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19V5M5 12l7-7 7 7"/>
            </svg>
          </button>
          <button type="button" onclick="scrollToSection(4)" class="nav-button">
            Next
          </button>
        </div>
      </div>
    </section>

    <!-- Contact details -->
    <section id="section-4" class="relative">
      <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl max-w-md w-full border border-amber-100">
        <label class="text-2xl font-bold mb-6 block text-amber-900">Contact Details</label>
        
        <label class="block font-semibold mb-3 text-amber-800">Contact Number</label>
        <input name="contactNumber" required type="tel" pattern="[0-9]{11}" title="Please enter an 11-digit number (e.g., 09123456789)" placeholder="e.g. 09XXXXXXXXX" class="w-full border border-amber-200 p-4 rounded-xl mb-6 focus:ring-2 focus:ring-amber-500 focus:border-transparent" />
        
        <div class="flex justify-between items-center mt-8">
          <button type="button" onclick="scrollToSection(3)" class="arrow-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19V5M5 12l7-7 7 7"/>
            </svg>
          </button>
          <button type="button" onclick="scrollToSection(5)" class="nav-button">
            Next
          </button>
        </div>
      </div>
    </section>

    <!-- Cookie selection (2x2) -->
    <section id="section-5" class="relative">
      <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl max-w-4xl w-full space-y-8 border border-amber-100">
        <h2 class="text-3xl font-bold text-amber-900 text-center">Choose your cookies</h2>
        
        <!-- Cart Preview -->
        <div class="bg-amber-50 p-6 rounded-2xl mb-6 border border-amber-200">
          <div class="flex justify-between items-center">
            <h3 class="text-lg font-semibold text-amber-900">üõí Your Cart</h3>
            <button type="button" onclick="openCartModal()" class="text-link">View Cart (<span id="cartCount">0</span> items)</button>
          </div>
          <p class="text-sm text-amber-700 mt-2">Total: ‚Ç±<span id="cartTotalPreview">0</span></p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">

          <!-- OG Set Card -->
          <div class="cookie-card p-8 rounded-2xl flex flex-col items-center" onclick="toggleCookieCard(this, 'ogSet')">
            <p class="font-semibold text-xl mb-2 text-amber-900">The OG Set</p>
            <p class="text-sm text-amber-600 mb-4">(3 cookies: The Usual, The Red One, The Burnt One)</p>
            <p class="font-bold text-amber-700 mb-4 text-xl">‚Ç±320</p>
            
            <!-- Quantity Section (Hidden by default) -->
            <div class="quantity-section items-center space-x-3">
              <button type="button" onclick="event.stopPropagation(); updateCardCount('ogSet', -1)" class="px-4 py-2 bg-amber-200 rounded-lg hover:bg-amber-300">-</button>
              <input type="number" id="ogSet" name="ogSet" value="0" min="0" class="w-16 text-center border border-amber-300 rounded-lg py-2" onclick="event.stopPropagation()">
              <button type="button" onclick="event.stopPropagation(); updateCardCount('ogSet', 1)" class="px-4 py-2 bg-amber-200 rounded-lg hover:bg-amber-300">+</button>
              <button type="button" onclick="event.stopPropagation(); addToCart('ogSet', 'OG Set', 320)" class="ml-2 bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg font-semibold">Add to Cart</button>
            </div>
          </div>

          <!-- Classic 6 Card -->
          <div class="cookie-card p-8 rounded-2xl flex flex-col items-center" onclick="toggleCookieCard(this, 'classic6')">
            <p class="font-semibold text-xl mb-2 text-amber-900">Classic 6</p>
            <p class="text-sm text-amber-600 mb-4">(6 cookies: Usual, Red, Burnt, Milky, Pistash, Bizz)</p>
            <p class="font-bold text-amber-700 mb-4 text-xl">‚Ç±660</p>
            
            <div class="quantity-section items-center space-x-3">
              <button type="button" onclick="event.stopPropagation(); updateCardCount('classic6', -1)" class="px-4 py-2 bg-amber-200 rounded-lg hover:bg-amber-300">-</button>
              <input type="number" id="classic6" name="classic6" value="0" min="0" class="w-16 text-center border border-amber-300 rounded-lg py-2" onclick="event.stopPropagation()">
              <button type="button" onclick="event.stopPropagation(); updateCardCount('classic6', 1)" class="px-4 py-2 bg-amber-200 rounded-lg hover:bg-amber-300">+</button>
              <button type="button" onclick="event.stopPropagation(); addToCart('classic6', 'Classic 6', 660)" class="ml-2 bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg font-semibold">Add to Cart</button>
            </div>
          </div>

          <!-- Samplers Card -->
          <div class="cookie-card p-8 rounded-2xl flex flex-col items-center" onclick="toggleCookieCard(this, 'samplers')">
            <p class="font-semibold text-xl mb-2 text-amber-900">Samplers</p>
            <p class="text-sm text-amber-600 mb-4">(6 pcs of Classics, 50g each)</p>
            <p class="font-bold text-amber-700 mb-4 text-xl">‚Ç±320</p>
            
            <div class="quantity-section items-center space-x-3">
              <button type="button" onclick="event.stopPropagation(); updateCardCount('samplers', -1)" class="px-4 py-2 bg-amber-200 rounded-lg hover:bg-amber-300">-</button>
              <input type="number" id="samplers" name="samplers" value="0" min="0" class="w-16 text-center border border-amber-300 rounded-lg py-2" onclick="event.stopPropagation()">
              <button type="button" onclick="event.stopPropagation(); updateCardCount('samplers', 1)" class="px-4 py-2 bg-amber-200 rounded-lg hover:bg-amber-300">+</button>
              <button type="button" onclick="event.stopPropagation(); addToCart('samplers', 'Samplers', 320)" class="ml-2 bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded-lg font-semibold">Add to Cart</button>
            </div>
          </div>

          <!-- Customize Your Cookie Box Card -->
          <div class="cookie-card p-8 rounded-2xl flex flex-col items-center bg-amber-50" onclick="toggleCustomBoxCard(this)">
            <p class="font-semibold text-xl mb-4 text-amber-900">üç™ Customize Your Cookie Box</p>
            <p class="text-sm text-amber-600 mb-4">Create your own cookie selection</p>
            
            <div class="quantity-section items-center">
              <span class="text-sm text-amber-600">Click to customize</span>
            </div>
          </div>

        </div>
        <div class="flex justify-between items-center mt-8">
          <button type="button" onclick="scrollToSection(4)" class="arrow-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19V5M5 12l7-7 7 7"/>
            </svg>
          </button>
          <button type="button" onclick="scrollToSection(6)" class="nav-button">
            Next
          </button>
        </div>
      </div>
    </section>

    <!-- Customize modal -->
    <div id="customizeModal" class="modal">
      <div class="modal-content">
        <div class="modal-header flex justify-between items-center">
          <h3 class="text-lg font-semibold text-amber-900">Customize Your Cookie Box</h3>
          <button type="button" onclick="closeCustomizeModal()" class="text-gray-500 hover:text-black text-2xl">&times;</button>
        </div>
         <!-- Body -->
        <div class="modal-body">
          <p class="font-semibold mb-2 text-amber-900">Select Box Size:</p>
          <div class="boxsize-list">
            <label class="boxsize-row" onclick="selectBoxSize(this)"><input type="radio" name="boxSize" value="4" class="hidden"><span class="text-amber-900">Pack of 4</span></label>
            <label class="boxsize-row" onclick="selectBoxSize(this)"><input type="radio" name="boxSize" value="6" class="hidden"><span class="text-amber-900">Box of 6</span></label>
            <label class="boxsize-row" onclick="selectBoxSize(this)"><input type="radio" name="boxSize" value="12" class="hidden"><span class="text-amber-900">Box of 12</span></label>
            <label class="boxsize-row" onclick="selectBoxSize(this)"><input type="radio" name="boxSize" value="others" class="hidden"><span class="text-amber-900">Others (Minimum 3 cookies)</span></label>
          </div>

          <div id="selectedSizeInfo" class="mt-4 p-3 bg-amber-50 rounded-lg hidden border border-amber-200">
            <p class="text-sm text-amber-800" id="sizeMessage"></p>
          </div>

          <p class="font-semibold mt-6 mb-2 text-amber-900">Select Cookies:</p>
          <div id="cookieList" class="cookie-list"></div>
        </div>

        <!-- Footer -->
        <div class="modal-footer">
          <button type="button" onclick="addCustomBoxToCart()" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 rounded-lg transition-all duration-300">
            Add to Cart
          </button>
        </div>
      </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
      <div class="modal-content">
        <div class="modal-header flex justify-between items-center">
          <h3 class="text-lg font-semibold text-amber-900">üõí Your Cart</h3>
          <button type="button" onclick="closeCartModal()" class="text-gray-500 hover:text-black text-2xl">&times;</button>
        </div>
        <div class="modal-body">
          <div id="cartItems" class="space-y-3">
            <!-- Cart items will be displayed here -->
          </div>
          <div id="emptyCartMessage" class="text-center text-amber-600 py-8">
            Your cart is empty
          </div>
          <div id="cartTotal" class="cart-total mt-4 hidden">
            Total: ‚Ç±<span id="cartTotalAmount">0</span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" onclick="closeCartModal()" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-semibold py-3 rounded-lg transition-all duration-300">
            Continue Shopping
          </button>
        </div>
      </div>
    </div>

    <!-- Payment -->
    <section id="section-6" class="relative">
      <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl max-w-md w-full border border-amber-100">
        <label class="text-2xl font-bold mb-4 block text-amber-900">Payment Method</label>
        <select name="payment" class="w-full border border-amber-200 p-4 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent">
          <option value="COD">Cash on Delivery</option>
          <option value="GCash">GCash</option>
          <option value="Bank Transfer">Bank Transfer</option>
        </select>
        <div class="flex justify-between items-center mt-8">
          <button type="button" onclick="scrollToSection(5)" class="arrow-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19V5M5 12l7-7 7 7"/>
            </svg>
          </button>
          <button type="button" onclick="scrollToSection(7)" class="nav-button">
            Next
          </button>
        </div>
      </div>
    </section>

    <!-- Notes -->
    <section id="section-7" class="relative">
      <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl max-w-md w-full border border-amber-100">
        <label class="text-2xl font-bold mb-4 block text-amber-900">Notes (Optional)</label>
        <textarea name="notes" class="w-full border border-amber-200 p-4 rounded-xl h-32 focus:ring-2 focus:ring-amber-500 focus:border-transparent" placeholder="Any special requests or instructions..."></textarea>
        <div class="flex justify-between items-center mt-8">
          <button type="button" onclick="scrollToSection(6)" class="arrow-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19V5M5 12l7-7 7 7"/>
            </svg>
          </button>
          <button type="button" onclick="buildOrderSummary(); scrollToSection(8);" class="nav-button">
            Next
          </button>
        </div>
      </div>
    </section>

    <!-- Summary -->
    <section id="section-8" class="relative">
      <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl max-w-lg w-full border border-amber-100">
        <h2 class="text-2xl font-bold mb-6 text-amber-900">Order Summary</h2>
        <div id="summaryContent" class="text-left space-y-3 text-amber-800"></div>
        <div class="flex justify-between items-center mt-8">
          <button type="button" onclick="scrollToSection(7)" class="arrow-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 19V5M5 12l7-7 7 7"/>
            </svg>
          </button>
          <button type="submit" class="nav-button bg-green-600 hover:bg-green-700">
            Submit Order ‚úÖ
          </button>
        </div>
      </div>
    </section>

  </form>

  <script>
    // ----- State -----
    let selectedBoxSize = null;
    let cart = [];

    const cookieFlavors = [
      { name: "The Usual", price: 100 },
      { name: "The Red One", price: 110 },
      { name: "The Burnt One", price: 110 },
      { name: "The Bizz", price: 115 },
      { name: "The Milky One", price: 110 },
      { name: "Pistash", price: 120 },
      { name: "The OT", price: 115 },
      { name: "Nut-so-Carrot", price: 130 },
      { name: "Espress-oh", price: 115 },
      { name: "Berry match", price: 120 }
    ];

    const setPrices = {
      ogSet: 320,
      classic6: 660,
      samplers: 320
    };

    // ----- Fixed JavaScript Functions -----
    function scrollToSection(id){ 
        const element = document.getElementById('section-'+id);
        if (element) {
            element.scrollIntoView({behavior:'smooth'});
        }
    }

    function openDateInput(){ 
        const input = document.getElementById('deliveryDateInput');
        if (input) {
            input.classList.remove('hidden'); 
        }
    }

    function selectDeliveryMethod(element, method) {
      document.querySelectorAll('.delivery-option').forEach(opt => {
        opt.classList.remove('active');
      });
      element.classList.add('active');
      
      const radio = element.querySelector('input[type="radio"]');
      if (radio) radio.checked = true;
    }

    function toggleCookieCard(card, inputId) {
      const isActive = card.classList.contains('active');
      
      if (isActive) {
        card.classList.remove('active');
      } else {
        document.querySelectorAll('.cookie-card').forEach(c => {
          c.classList.remove('active');
        });
        card.classList.add('active');
        
        const input = document.getElementById(inputId);
        if (input && parseInt(input.value) === 0) {
          input.value = 1;
        }
      }
    }

    function toggleCustomBoxCard(card) {
      const isActive = card.classList.contains('active');
      
      if (isActive) {
        card.classList.remove('active');
      } else {
        document.querySelectorAll('.cookie-card').forEach(c => {
          c.classList.remove('active');
        });
        card.classList.add('active');
        openCustomizeModal();
      }
    }

    function updateCardCount(inputId, delta) {
      const input = document.getElementById(inputId);
      if (input) {
        let value = parseInt(input.value) || 0;
        input.value = Math.max(0, value + delta);
      }
    }

    function addToCart(inputId, itemName, price) {
      const quantity = parseInt(document.getElementById(inputId).value) || 0;
      
      if (quantity <= 0) {
        alert('Please select at least 1 quantity');
        return;
      }

      const existingIndex = cart.findIndex(item => item.id === inputId && item.type === 'premade');
      
      if (existingIndex > -1) {
        cart[existingIndex].quantity = quantity;
        cart[existingIndex].total = price * quantity;
      } else {
        cart.push({
          id: inputId,
          type: 'premade',
          name: itemName,
          price: price,
          quantity: quantity,
          total: price * quantity
        });
      }

      updateCartDisplay();
      
      document.getElementById(inputId).value = 0;
      const card = document.querySelector(`.cookie-card[onclick*="${inputId}"]`);
      if (card) {
        card.classList.remove('active');
      }
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      updateCartDisplay();
    }

    function updateCartDisplay() {
      const cartCount = document.getElementById('cartCount');
      const cartTotalPreview = document.getElementById('cartTotalPreview');
      const cartItems = document.getElementById('cartItems');
      const emptyCartMessage = document.getElementById('emptyCartMessage');
      const cartTotal = document.getElementById('cartTotal');
      const cartTotalAmount = document.getElementById('cartTotalAmount');

      // Check if elements exist before manipulating them
      if (!cartCount || !cartTotalPreview || !cartItems || !emptyCartMessage || !cartTotal || !cartTotalAmount) {
        console.log('Cart elements not found');
        return;
      }

      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const totalAmount = cart.reduce((sum, item) => sum + item.total, 0);
      
      cartCount.textContent = totalItems;
      cartTotalPreview.textContent = totalAmount;

      if (cart.length === 0) {
        emptyCartMessage.classList.remove('hidden');
        cartItems.innerHTML = '';
        cartTotal.classList.add('hidden');
      } else {
        emptyCartMessage.classList.add('hidden');
        cartTotal.classList.remove('hidden');
        cartTotalAmount.textContent = totalAmount;

        cartItems.innerHTML = cart.map((item, index) => `
          <div class="cart-item">
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <h4 class="font-semibold">${item.name}</h4>
                ${item.type === 'customBox' ? 
                  `<p class="text-sm text-gray-600">Box of ${item.boxSize}</p>
                   <p class="text-sm text-gray-600">${item.items.map(it => `${it.name} (x${it.qty})`).join(', ')}</p>` : 
                  `<p class="text-sm text-gray-600">Quantity: ${item.quantity}</p>`
                }
                <p class="font-semibold">‚Ç±${item.total}</p>
              </div>
              <button type="button" onclick="removeFromCart(${index})" class="text-red-500 hover:text-red-700 ml-2">üóëÔ∏è</button>
            </div>
          </div>
        `).join('');
      }
    }

    function openCartModal() {
      const modal = document.getElementById("cartModal");
      if (modal) {
        modal.classList.add("active");
        document.body.classList.add("no-scroll");
        updateCartDisplay();
      }
    }

    function closeCartModal() {
      const modal = document.getElementById("cartModal");
      if (modal) {
        modal.classList.remove("active");
        document.body.classList.remove("no-scroll");
      }
    }

    function generateWeekendDates(){
      const container = document.getElementById('quickDates');
      if (!container) return;
      
      const today = new Date();
      let count = 0, dayOffset = 0; 
      container.innerHTML = '';
      
      while(count < 6){
        const future = new Date(); 
        future.setDate(today.getDate() + dayOffset);
        const day = future.getDay();
        if([5,6,0].includes(day)){
          const yyyy = future.getFullYear(); 
          const mm = String(future.getMonth()+1).padStart(2,'0'); 
          const dd = String(future.getDate()).padStart(2,'0');
          const dateStr = `${yyyy}-${mm}-${dd}`;
          const btn = document.createElement('button'); 
          btn.type='button'; 
          btn.textContent = `${mm}/${dd}`;
          btn.className = 'bg-yellow-300 px-3 py-2 rounded text-sm';
          btn.onclick = ()=>{ 
            const input = document.getElementById('deliveryDateInput'); 
            if (input) {
              input.value = dateStr; 
              input.classList.remove('hidden'); 
            }
          };
          container.appendChild(btn); 
          count++; 
        }
        dayOffset++; 
      }
    }

    function setDateRestrictions(){
      const input = document.getElementById('deliveryDateInput');
      if (input) {
        const today = new Date(); 
        input.setAttribute('min', today.toISOString().split('T')[0]);
        input.addEventListener('input', function(){ 
          const chosenDate = new Date(this.value); 
          if(![5,6,0].includes(chosenDate.getDay())){ 
            alert('Only Friday, Saturday, or Sunday are allowed.'); 
            this.value = ''; 
          } 
        });
      }
    }

    function renderCookieList(){
      const container = document.getElementById('cookieList'); 
      if(!container) return; 
      
      container.innerHTML = '';
      cookieFlavors.forEach((flavor, idx) => {
        const row = document.createElement('div'); 
        row.className = 'cookie-row'; 
        row.dataset.cookie = flavor.name;
        row.onclick = function() { toggleCookieSelection(this); };

        const label = document.createElement('div'); 
        label.className = 'flex-1 flex justify-between pr-4 cursor-pointer';
        label.innerHTML = `<span>${flavor.name}</span><span class="cookie-price">‚Ç±${flavor.price}</span>`;

        const qtyDiv = document.createElement('div'); 
        qtyDiv.className = 'quantity-control hidden items-center';
        qtyDiv.innerHTML = `<button type="button" class="qty-btn" onclick="event.stopPropagation(); updateCookieQty(this, -1)">-</button><input type="number" value="1" min="0" class="cookie-qty-input" onclick="event.stopPropagation()" /><button type="button" class="qty-btn" onclick="event.stopPropagation(); updateCookieQty(this, 1)">+</button>`;

        row.appendChild(label); 
        row.appendChild(qtyDiv); 
        container.appendChild(row);
      });
    }

    function toggleCookieSelection(row) {
      const isActive = row.classList.contains('active');
      
      if (isActive) {
        row.classList.remove('active');
        const qtyInput = row.querySelector('.cookie-qty-input');
        if (qtyInput) qtyInput.value = 1;
      } else {
        row.classList.add('active');
      }
    }

    function updateCookieQty(button, delta) {
      const qtyDiv = button.closest('.quantity-control');
      if (!qtyDiv) return;
      
      const inputEl = qtyDiv.querySelector('input');
      if (!inputEl) return;
      
      let v = parseInt(inputEl.value, 10) || 0;
      v = Math.max(0, v + delta);
      inputEl.value = v;
      
      if (v === 0) {
        const row = qtyDiv.closest('.cookie-row');
        if (row) {
          qtyDiv.classList.add('hidden');
          row.classList.remove('active');
        }
      }
    }

    function selectBoxSize(row){ 
      document.querySelectorAll('.boxsize-row').forEach(r=> r.classList.remove('active')); 
      row.classList.add('active'); 
      const radio = row.querySelector('input[type="radio"]');
      if (radio) {
        selectedBoxSize = radio.value;
      }
      
      const sizeInfo = document.getElementById('selectedSizeInfo');
      const sizeMessage = document.getElementById('sizeMessage');
      
      if (sizeInfo && sizeMessage) {
        if (selectedBoxSize === 'others') {
          sizeMessage.textContent = 'Please select at least 3 cookies for your custom box.';
          sizeInfo.classList.remove('hidden');
        } else {
          sizeMessage.textContent = `Please select exactly ${selectedBoxSize} cookies for your box.`;
          sizeInfo.classList.remove('hidden');
        }
      }
    }

    function getSelectedCookies(){ 
      const selections = []; 
      document.querySelectorAll('#cookieList .cookie-row.active').forEach(r=>{
        const qtyDiv = r.querySelector('.quantity-control'); 
        if(!qtyDiv) return; 
        const q = parseInt(qtyDiv.querySelector('input').value,10)||0; 
        if(q>0) {
          const cookieName = r.dataset.cookie;
          const cookie = cookieFlavors.find(c => c.name === cookieName);
          selections.push({ 
            name: cookieName, 
            qty: q,
            price: cookie ? cookie.price : 0
          }); 
        }
      }); 
      return selections; 
    }

    function openCustomizeModal() {
      const modal = document.getElementById("customizeModal");
      if (modal) {
        modal.classList.add("active");
        document.body.classList.add("no-scroll");
        renderCookieList();
        selectedBoxSize = null;
        document.querySelectorAll('.boxsize-row').forEach(r => r.classList.remove('active'));
        
        const sizeInfo = document.getElementById('selectedSizeInfo');
        if (sizeInfo) {
          sizeInfo.classList.add('hidden');
        }
      }
    }

    function closeCustomizeModal() {
      const modal = document.getElementById("customizeModal");
      if (modal) {
        modal.classList.remove("active");
        document.body.classList.remove("no-scroll");
      }
    }

    function addCustomBoxToCart(){
      if(!selectedBoxSize){ alert('Please select a box size first'); return; }
      const items = getSelectedCookies(); 
      if(items.length === 0){ alert('Please select at least one cookie for your custom box'); return; }
      
      const totalQty = items.reduce((sum, item) => sum + item.qty, 0);
      
      if (selectedBoxSize === 'others') {
        if (totalQty < 3) {
          alert(`Please select at least 3 cookies for your custom box. Currently selected: ${totalQty}`);
          return;
        }
      } else {
        if (totalQty != selectedBoxSize) {
          alert(`Please select exactly ${selectedBoxSize} cookies for your box. Currently selected: ${totalQty}`);
          return;
        }
      }
      
      const totalPrice = items.reduce((sum, item) => sum + (item.price * item.qty), 0);
      
      cart.push({
        type: 'customBox',
        name: selectedBoxSize === 'others' ? `Custom Box (${totalQty} cookies)` : `Custom Box of ${selectedBoxSize}`,
        boxSize: selectedBoxSize === 'others' ? totalQty.toString() : selectedBoxSize,
        items: [...items],
        price: totalPrice,
        quantity: 1,
        total: totalPrice
      });

      updateCartDisplay();
      closeCustomizeModal();
      
      const customBoxCard = document.querySelector('.cookie-card:last-child');
      if (customBoxCard) {
        customBoxCard.classList.remove('active');
      }
      
      selectedBoxSize = null;
      document.querySelectorAll('.boxsize-row').forEach(r => r.classList.remove('active'));
      document.querySelectorAll('.cookie-row').forEach(r => {
        r.classList.remove('active');
        const qtyInput = r.querySelector('.cookie-qty-input');
        if (qtyInput) qtyInput.value = 1;
      });
    }

    // ----- Google Forms Submission -----
    async function submitToGoogleForms(formData) {
        // REPLACE THIS WITH YOUR ACTUAL GOOGLE FORM URL
        const formUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSfpWgm_iikunZ44T7HxQfnbmA1KY-bB4l57fnAN0vAaFo0ZsA/formResponse';
        
        // Calculate individual cookie quantities
        const cookieQuantities = {};
        cart.forEach(item => {
            if (item.type === 'premade') {
                if (item.name === 'OG Set') {
                    cookieQuantities['The Usual'] = (cookieQuantities['The Usual'] || 0) + item.quantity;
                    cookieQuantities['The Red One'] = (cookieQuantities['The Red One'] || 0) + item.quantity;
                    cookieQuantities['The Burnt One'] = (cookieQuantities['The Burnt One'] || 0) + item.quantity;
                } else if (item.name === 'Classic 6') {
                    cookieQuantities['The Usual'] = (cookieQuantities['The Usual'] || 0) + item.quantity;
                    cookieQuantities['The Red One'] = (cookieQuantities['The Red One'] || 0) + item.quantity;
                    cookieQuantities['The Burnt One'] = (cookieQuantities['The Burnt One'] || 0) + item.quantity;
                    cookieQuantities['The Milky One'] = (cookieQuantities['The Milky One'] || 0) + item.quantity;
                    cookieQuantities['Pistash'] = (cookieQuantities['Pistash'] || 0) + item.quantity;
                    cookieQuantities['The Bizz'] = (cookieQuantities['The Bizz'] || 0) + item.quantity;
                } else if (item.name === 'Samplers') {
                    cookieQuantities['Sampler Pack'] = (cookieQuantities['Sampler Pack'] || 0) + item.quantity;
                }
            } else if (item.type === 'customBox') {
                item.items.forEach(cookieItem => {
                    cookieQuantities[cookieItem.name] = (cookieQuantities[cookieItem.name] || 0) + cookieItem.qty;
                });
            }
        });

        const orderDetails = cart.map(item => {
            if (item.type === 'customBox') {
                return `${item.name}: ${item.items.map(it => `${it.name}(x${it.qty})`).join(', ')}`;
            } else {
                return `${item.name} x ${item.quantity}`;
            }
        }).join('; ');

        const cookieQuantitiesText = Object.entries(cookieQuantities)
            .map(([cookie, qty]) => `${cookie}: ${qty}`)
            .join('; ');

        const totalAmount = cart.reduce((sum, item) => sum + item.total, 0);

        // REPLACE THESE ENTRY IDs WITH YOUR ACTUAL GOOGLE FORM FIELD IDs
        const params = new URLSearchParams({
            'entry.1608348325': formData.get('name') || '',             // Name
            'entry.756795480': formData.get('socialHandle') || '',      // Social Handle
            'entry.1868351860': formData.get('deliveryDate') || '',     // Delivery Date
            'entry.1213945014': formData.get('deliveryMethod') || '',   // Delivery Method
            'entry.216379063': formData.get('contactNumber') || '',     // Contact Number
            'entry.1369240809': formData.get('payment') || '',          // Payment Method
            'entry.564442403': formData.get('notes') || '',             // Notes
            'entry.1344414632': orderDetails,                           // Order Details
            'entry.950008786': cookieQuantitiesText,                    // Cookie Quantities
            'entry.1858160446': totalAmount.toString()                  // Total Amount
        });

        // Submit to Google Forms using no-cors mode
        try {
            await fetch(formUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: params
            });
            return true;
        } catch (error) {
            console.log('Form submission attempted (no-cors mode)');
            return true; // With no-cors, we can't verify success, but assume it worked
        }
    }

    function buildOrderSummary(){
      const form = document.getElementById('orderForm'); 
      if (!form) return;
      
      const name = form.name.value.trim(); 
      const social = form.socialHandle.value.trim(); 
      const deliveryDate = form.deliveryDate.value || '‚Äî';
      const deliveryMethod = form.deliveryMethod?.value || 'Not selected';
      const contact = form.contactNumber.value.trim(); 
      const notes = form.notes.value.trim();
      const payment = form.payment.value;

      let totalAmount = 0;
      let html = `<strong>Name:</strong> ${escapeHtml(name)}<br>
                  <strong>Social:</strong> ${escapeHtml(social)}<br>
                  <strong>Delivery Date:</strong> ${escapeHtml(deliveryDate)}<br>
                  <strong>Delivery Method:</strong> ${escapeHtml(deliveryMethod === 'pickup' ? 'Pick Up' : 'Delivery')}<br>
                  <strong>Contact Number:</strong> ${escapeHtml(contact)}<br>
                  <strong>Payment Method:</strong> ${escapeHtml(payment)}<br><hr>`;
      
      html += `<strong>Order Items:</strong><br>`;
      
      if(cart.length > 0){
        cart.forEach((item, index) => {
          totalAmount += item.total;
          if (item.type === 'customBox') {
            html += `- ${item.name}: ` + 
                    item.items.map(it => `${it.name} x ${it.qty}`).join(', ') + 
                    ` = ‚Ç±${item.total}<br>`;
          } else {
            html += `- ${item.name} x ${item.quantity} = ‚Ç±${item.total}<br>`;
          }
        });
      } else {
        html += `No items in cart<br>`;
      }
      
      html += `<hr><strong>Total Amount:</strong> ‚Ç±${totalAmount}<br>`;
      html += `<hr><strong>Notes:</strong><br>${escapeHtml(notes)}<br>`;
      
      const summaryContent = document.getElementById('summaryContent');
      if (summaryContent) {
        summaryContent.innerHTML = html;
      }
    }

    async function handleFormSubmit(e){ 
      e.preventDefault(); 
      
      if (cart.length === 0) {
        alert('Please add at least one item to your cart before submitting.');
        return;
      }
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Submitting...';
      submitBtn.classList.add('loading');
      
      try {
        const formData = new FormData(document.getElementById('orderForm'));
        
        await submitToGoogleForms(formData);
        
        alert('Order submitted successfully! Thank you for your order!');
        
        document.getElementById('orderForm').reset();
        cart = [];
        updateCartDisplay();
        document.querySelectorAll('.cookie-card').forEach(card => {
          card.classList.remove('active');
        });
        scrollToSection(1);
        
      } catch (error) {
        console.error('Error:', error);
        alert('There was an error submitting your order. Please try again or contact us directly.');
      } finally {
        submitBtn.textContent = originalText;
        submitBtn.classList.remove('loading');
      }
    }

    function escapeHtml(str){ 
      if(!str) return '‚Äî'; 
      return String(str).replace(/[&<>"']/g, s=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s])); 
    }

    // ----- Init -----
    document.addEventListener('DOMContentLoaded', ()=>{
      generateWeekendDates(); 
      setDateRestrictions(); 
      renderCookieList();
      
      const orderForm = document.getElementById('orderForm');
      if (orderForm) {
        orderForm.addEventListener('submit', handleFormSubmit);
      }
      
      updateCartDisplay();
    });
  </script>
</body>
</html>
